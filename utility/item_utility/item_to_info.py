window_data = {
    "furnace": {
        "title": "Furnace",
        "description": "A blazing hot furnace. Right click to go to the Furnace!",
        "data": [],
    },
    "anvil": {
        "title": "Anvil",
        "description": "A shiny anvil. Right click to go to the Anvil!",
        "data": [],
    },
    "map": {
        "title": "Map",
        "description": "Allows travel to islands. Right click to open the map!",
        "data": [],
    },
    "craft": {
        "title": "Craft",
        "description": "Right click to go to the Workstation!",
        "data": [],
    },
    "coal_pile": {
        "title": "Coal Pile",
        "description": "A pile of fuel for the furnace.",
        "data": [
            {"lookup_label": "draining", "display_label": "Drain per second", "data_type": "percent"},
            {"lookup_label": "fuel_level", "display_label": "Fuel Level", "data_type": "bar"}
        ],
    },
    "map_boat": {
        "title": "Your Boat",
        "description": "This is your boat.",
        "data": [],
    },
    "island1": {
        "title": "placeholder island",
        "description": "island where dreams come true i think",
        "data": [],
    },
    "copper_ore": {
        "title": "Copper Ore",
        "description": "Copper ore is a native metal, which means it can be used witho alloying or refining. It is rather soft, but can be easily forged and therefore is a perfect starter metal for beginners.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "copper_ingot": {
        "title": "Copper Ingot",
        "description": "A solid bar of copper. Can be forged after heating.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "iron_ore": {
        "title": "Iron Ore",
        "description": "Iron ore is a common metal, with higher strength than copper. However, it requires hotter temperatures to forge, requiring more fuel or higher forge efficiency.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "iron_ingot": {
        "title": "Iron Ingot",
        "description": "A solid bar of Iron. As carbon is added, strength increases, forming high carbon steel. adding too much can result in the compound weakening.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "lead_ore": {
        "title": "Lead Ore",
        "description": "Lead is a very dense metal. It's the end of many major nuclear chains, and can hold magic easier due to high proton count.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "lead_ingot": {
        "title": "Lead Ingot",
        "description": "Denser metals hold magic easier. Therefore, lead is perfect for magically infused items.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "lomium_ore": {
        "title": "Lomium Ore",
        "description": "Lomium, despite it's appearance, is a strong crystalline structure. It's a metal that smells sweetly of sugar, and has high tensile strength at base without being treated.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ], # in the future, i can show impurities as cloudiness in the metal, or add specks or some opacity layer.
    },
    "lomium_ingot": {
        "title": "Lomium Ingot",
        "description": "A strong yet lightweight metal. Forging it can prove to be difficult, however the result is a beautiful sky blue metal that can stand up to deadly blows.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "silver_ore": {
        "title": "Silver Ore",
        "description": "Silver is a shiny, lustrous metal, that's stronger than copper and incredibly valuable.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ], 
    },
    "silver_ingot": {
        "title": "Silver Ingot",
        "description": "A solid silver ingot. It's rarity and beauty makes it perfect for jewelry and decorative pieces, aswell as having a strong effect on certain monsters.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "titanium_ore": {
        "title": "Titanium Ore",
        "description": "Titanium has the highest strength to weight ratio of any metal, however lacks the hardness to maintain an edge.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ], 
    },
    "titanium_ingot": {
        "title": "Titanium Ingot",
        "description": "Titanium is a strong metal, but lacks the ability to maintain an edge. It can also be anodized, which can increase value substantially.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "impurities", "display_label": "Impurities", "data_type": "percent"}
        ],
    },
    "large_coal": {
        "title": "Large Coal",
        "description": "A large deposit of coal. Can be put in the furnace.",
        "data": [{"lookup_label": "fuel", "display_label": "Fuel", "data_type": "number"}],
    },
    "medium_coal": {
        "title": "Medium Coal",
        "description": "A medium deposit of coal. Can be put in the furnace.",
        "data": [{"lookup_label": "fuel", "display_label": "Fuel", "data_type": "number"}],
    },
    "small_coal": {
        "title": "Small Coal",
        "description": "A small deposit of coal. Can be put in the furnace.",
        "data": [{"lookup_label": "fuel", "display_label": "Fuel", "data_type": "number"}],
    },
    "log": {
        "title": "Log",
        "description": "A hefty log. Can be put in the furnace.",
        "data": [{"lookup_label": "fuel", "display_label": "Fuel", "data_type": "number"}],
    },
    ######## BOTTLES ############
    "large_bottle": {
        "title": "Large Bottle",
        "description": "A bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "hexagon_bottle": {
        "title": "Hexagon Bottle",
        "description": "A bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "gold_bottle": {
        "title": "Gold Bottle",
        "description": "An enchanted bottle. Can store all liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "crescent_bottle": {
        "title": "Crescent Bottle",
        "description": "A bottle with an embedded amethyst. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "circle_bottle": {
        "title": "Circle Bottle",
        "description": "A bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "spiked_bottle": {
        "title": "Spiked Bottle",
        "description": "A bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "uranium_bottle": {
        "title": "Uranium Bottle",
        "description": "A bottle made from uranium glass. Can store most liquids. May have slight side effects.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "tall_bottle": {
        "title": "Tall Bottle",
        "description": "A bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "small_uranium_bottle": {
        "title": "Small Uranium Bottle",
        "description": "A bottle made from uranium glass. Can store most liquids. May have slight side effects.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "small_bottle": {
        "title": "Small Bottle",
        "description": "A bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "red_bottle": {
        "title": "Red Bottle",
        "description": "An intricate bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "mini_bottle": {
        "title": "Mini Bottle",
        "description": "A very small bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "brown_bottle": {
        "title": "Brown Bottle",
        "description": "A bottle. Can store most liquids.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    "chain_bottle": {
        "title": "Chain Bottle",
        "description": "An enchanted bottle. Can store most liquids. can also capture mythical beasts.",
        "data": [
            {"lookup_label": "capacity", "display_label": "Capacity", "data_type": "number"},
            {"lookup_label": "contents", "display_label": "Contents", "data_type": "number"},
            {"lookup_label": "liquid", "display_label": "Liquid", "data_type": "highlight"}
        ],
    },
    ###### GEMS #########
    "aquamarine": {
        "title": "Aquamarine",
        "description": "A shiny light blue gem.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "quality", "display_label": "Quality", "data_type": "percent"},
            {"lookup_label": "element", "display_label": "Element", "data_type": "highlight"}
        ],
    },
    "citrine": {
        "title": "Citrine",
        "description": "A shiny pale orange gem.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "quality", "display_label": "Quality", "data_type": "percent"},
            {"lookup_label": "element", "display_label": "Element", "data_type": "highlight"}
        ],
    },
    "emerald": {
        "title": "Emerald",
        "description": "A shiny green gem.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "quality", "display_label": "Quality", "data_type": "percent"},
            {"lookup_label": "element", "display_label": "Element", "data_type": "highlight"}
        ],
    },
    "rhotochrosite": {
        "title": "Rhotochrosite",
        "description": "A shiny light pink gem.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "quality", "display_label": "Quality", "data_type": "percent"},
            {"lookup_label": "element", "display_label": "Element", "data_type": "highlight"}
        ],
    },
    "tourmaline": {
        "title": "Tourmaline",
        "description": "A shiny red gem.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "quality", "display_label": "Quality", "data_type": "percent"},
            {"lookup_label": "element", "display_label": "Element", "data_type": "highlight"}
        ],
    },
    "flawless_tourmaline": {
        "title": "Flawless Tourmaline",
        "description": "A gemstone cut by a master craftsman.",
        "data": [
            {"lookup_label": "mass", "display_label": "Mass", "data_type": "number"},
            {"lookup_label": "quality", "display_label": "Quality", "data_type": "percent"},
            {"lookup_label": "element", "display_label": "Element", "data_type": "highlight"},
            {"lookup_label": "bonus", "display_label": "Bonus", "data_type": "percent"}
        ],
    },
    ##### PARTS #####
    "rounded_pommel": {
        "title": "Rounded Pommel",
        "description": "A basic pommel.",
        "data": [
            {"lookup_label": "material", "display_label": "Material", "data_type": "highlight"},
            {"lookup_label": "temperature", "display_label": "Temperature", "data_type": "number"},
            {"lookup_label": "quality", "display_label": "Quality", "data_type": "percent"}
        ],
    },
    #### TOOLS ####
    "sword": {
        "title": "Sword",
        "description": "A basic sword.",
        "data": [
            {"lookup_label": "blade.material", "display_label": "Blade Material", "data_type": "highlight"},
            {"lookup_label": "blade.quality", "display_label": "Blade Quality", "data_type": "percent"},
            {"lookup_label": "guard.material", "display_label": "Guard Material", "data_type": "highlight"},
            {"lookup_label": "guard.quality", "display_label": "Guard Quality", "data_type": "percent"},
            {"lookup_label": "handle.material", "display_label": "Handle Material", "data_type": "highlight"},
            {"lookup_label": "handle.quality", "display_label": "Handle Quality", "data_type": "percent"},
            {"lookup_label": "pommel.material", "display_label": "Pommel Material", "data_type": "highlight"},
            {"lookup_label": "pommel.quality", "display_label": "Pommel Quality", "data_type": "percent"},
            {"lookup_label": "rarity", "display_label": "Rarity", "data_type": "bar"},
            {"lookup_label": "quality", "display_label": "Quality", "data_type": "bar"}
        ],
    },
}
from utility.animated_sprite import AnimatedTile
from utility.gui_utility.hoverWindow import *
import json
import os

placeholder = {
    "title":"???",
    "description":"an item with no description. probably a bug."
}

def item_to_info(item, inspecting, language):
    item_name = getattr(item, "item_name", "No Item Name")
    # Default data
    if item_name in window_data:
        data_entry = window_data[item_name]
    else:
        print(f"[ITEM_TO_INFO.py] item '{item_name}' not in window_data. Using placeholder.")
        data_entry = placeholder

    # --- Translation support ---
    title = data_entry.get("title", item_name)
    description = data_entry.get("description", "")
    translation_labels = {}
    if language and language.lower() != "english":
        translation_path = os.path.join("assets", "translations", f"{language}.json")
        if os.path.exists(translation_path):
            try:
                with open(translation_path, "r", encoding="utf-8") as f:
                    translations = json.load(f)
                    translations = translations["items"] # only load item portion
                if item_name in translations:
                    trans_entry = translations[item_name]
                    title = trans_entry.get("title", title)
                    description = trans_entry.get("description", description)
                    # Get translated display labels for fields
                    translation_labels = trans_entry.get("labels", {})
            except Exception as e:
                print(f"[ITEM_TO_INFO.py] Error loading translation for '{item_name}': {e}")
        else:
            print(f"[ITEM_TO_INFO.py] Translation file not found: {translation_path}")

    hover_data = []
    reduced_data = []

    # Parse data list into HoverData
    item_data = data_entry.get("data", [])
    for field in item_data:
        lookup_label = field.get("lookup_label")
        display_label = field.get("display_label")
        data_type = field.get("data_type")
        # Use translated display label if available
        if translation_labels and lookup_label in translation_labels:
            display_label = translation_labels[lookup_label]
        value = get_nested_attr(item, lookup_label, default="N/A")
        if value == "N/A" or value == None:
            continue
        anim_tile = None
        if data_type == "highlight":
            if isinstance(value, str):
                try:
                    anim_tile = get_highlight(value)
                except Exception as e:
                    print(f"[ITEM_TO_INFO.py] Could not load AnimatedTile from '{value}': {e}")
            elif isinstance(value, AnimatedTile):
                anim_tile = value
            else:
                print(f"[ITEM_TO_INFO.py] Invalid highlight value for '{lookup_label}': {value}")
            hover_data.append(HoverData(label=display_label, data_type="highlight", anim_tile=anim_tile, lookup_label=lookup_label))
        elif data_type in ("number", "percent", "bar"):
            hover_data.append(HoverData(label=display_label, value=round(value, 3), data_type=data_type, lookup_label=lookup_label))
        else:
            hover_data.append(HoverData(label=display_label, value=value, data_type="number", lookup_label=lookup_label))
    return HoverInfo(
        title=title,
        description=description,
        icon=None,
        data=hover_data,
        reduced_data=reduced_data,
        mode="default" if inspecting else "reduced",
        source_item=item
    )


highlights = {
    "default": "assets/items/highlights/default",
    "copper": "assets/items/highlights/copper"
}

def get_highlight(name):
    # Always use default if name is None, 'N/A', or not in highlights
    if not name or name == "N/A" or name not in highlights:
        name = "default"
    return AnimatedTile(highlights[name], 100)

def get_nested_attr(obj, attr_path, default=None):
    parts = attr_path.split(".")
    for part in parts:
        if isinstance(obj, dict):
            obj = obj.get(part, default)
        else:
            obj = getattr(obj, part, default)
        if obj == default:
            break
    return obj
